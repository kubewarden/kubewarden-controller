name: Update Golang version

pipelineid: golang/version

sources:
  go:
    name: Get latest Golang version
    kind: golang

conditions:
  docker:
    name: Check Docker image tag
    kind: dockerimage
    sourceid: go
    spec:
      image: golang

targets:
  gomod:
    name: 'deps(go): update Go version to {{ source "go" }}'
    sourceid: go
    kind: golang/gomod
    scmid: default
    spec:
      file: go.mod

  dockerfile:
    name: "deps(go): update Docker image tag"
    kind: dockerfile
    sourceid: go
    scmid: default
    spec:
      files:
        - Dockerfile.kubewarden-controller
        - Dockerfile.audit-scanner
      instruction:
        keyword: FROM
        matcher: golang

actions:
  default:
    title: 'deps(go): update Go to {{ source "go" }} version'
    kind: github/pullrequest
    scmid: default
    spec:
      automerge: false
      mergemethod: squash
      description: |
        Automatic Golang version {{ source "go" }} update.
        This PR has been created by the automation used to automatically update the Golang version in the kubewarden-controller project
        REMEMBER IF YOU WANT TO MERGE IN A SINGLE COMMIT CHANGES AND VERSION BUMP, YOU MUST SQUASH THE COMMIT BEFORE MERGING THIS PR!
      draft: false
      labels:
        - "chore"
        - "dependencies"

scms:
  default:
    kind: github
    spec:
      user: "{{ .github.author }}"
      email: "{{ .github.email }}"
      owner: "{{ .github.owner }}"
      repository: "kubewarden-controller"
      branch: "{{ .github.branch }}"
      commitusingapi: true
      commitmessage:
        type: "chore"
        scope: deps
        title: "update Golang version"
        footers: "Signed-off-by: kubewarden-controller bot <kubewarden-controller-bot@users.noreply.github.com>"
        hidecredit: true
